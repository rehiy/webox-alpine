#!/bin/sh
#

wkit goaccess restart

###

. /etc/goaccess/env-vars

if [ ! -d $DATA_DIR/archive ]; then
    mkdir -p $DATA_DIR/archive
fi

###

log=`find /var/log/nginx -name "access.log-*[0-9]"`

dbp=$DATA_DIR/database
out=$DATA_DIR/archive/${log##*-}

goaccess $log --process-and-exit --agent-list --real-os --persist --restore --db-path=$dbp

goaccess -o $out.json --agent-list --real-os --restore --db-path=$dbp
goaccess -o $out.html --agent-list --real-os --restore --db-path=$dbp
